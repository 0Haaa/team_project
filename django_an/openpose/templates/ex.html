<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
  </head>
  <body>
    <button id="start-camera">Start Camera</button>
    <video id="video" width="320" height="240" autoplay></video>
    <button id="click-photo">Click Photo</button>
    <button id="stop-camera">Stop camera</button>
    <canvas id="canvas" width="320" height="240"></canvas>

    <script>
        let camera_button = document.querySelector("#start-camera");
        let video = document.querySelector("#video");
        let click_button = document.querySelector("#click-photo");
        let stop_camera_button = document.querySelector("#stop-camera");
        let canvas = document.querySelector("#canvas");
                

        // camera_button을 클릭하면 영상을 시작하도록 구현
        camera_button.addEventListener('click', async function(){
            let stream = await navigator.mediaDevices.getUserMedia({ video:true});
            video.srcObject = stream;
            

            // stop_camera_button을 클릭하면 영상이 멈추도록 구현
            stop_camera_button.addEventListener('click', async function(){
                stopStream(stream);
            });
        });

        // click_button을 클릭하면 이미지가 캡처되도록 구현
        click_button.addEventListener('click', function() {
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
        let image_data_url = canvas.toDataURL('image/jpeg');

        // data url of the image
        console.log(image_data_url);
        });

        
        // 웹캠을 정지하는 함수 구현
        function stopStream(stream) {
        console.log('webcam stop');
        stream.getVideoTracks().forEach(function (track) {
            track.stop();
        });
    }

    </script>
  </body>
</html>